<!DOCTYPE html>
<html lang="en">
<head>
   
  
  
    <link rel="stylesheet" href="./chat.css">
    <title>Chat Window</title>
</head>
<body>
    <h2 id="app">Chat Window</h2>

    <div id="chats" style="align-items: center; width: 65%; height: 45%; background-color: rgb(166, 201, 231); list-style: none;">
    </div>
    <div id="msg" style="list-style:none;">

    </div>

    <div id="chatFooter">
        <input type="text" placeholder="Enter Message" size="50" id="chatMessageInput">
        <button class="btn">Send</button>
    </div>

<div class="left">
    <h1>Group Chat</h1>
  
    <button id ="addGroup">Add Group</button>
    <form id="addGroupForm" class="hidden">
        <label for="Group Name">Group Name
        </label>
        <br>
        <input type="text" id="inputGroupName" size="50">
        <br>
        <button id="addGroupSubmitButton">Submit</button>
        
    </form>
    <div id="availableGroup">
        <h1>Available Group</h1>
       <!-- <div>Group1 <button id="addUser" onclick='addUserGroup(event)'>Add User</button> <button>Open Chat</button></div> -->
    </div>
    <div>
         <div class="hidden" id="addUserForm">
        <h1>Add User</h1>
        <form class="add-formStyle">
            <label for="name">Enter Email
            </label>
            <br>
            <input type="text" id="inputEmail" size="50">
            <br>
            <button id="addUserSubmitButton">Submit</button>
        </form>
    </div>
    <div class="hidden" id="addAdminForm">
        <h1>Add Admin</h1>
        <form class="add-formStyle">
            <label for="Email">Enter Email
            </label>
            <br>
            <input type="text" id="inputEmail-admin" size="50">
            <br>
            <button id="addAdminSubmitButton">Submit</button>
        </form>
    </div>
    <div class="hidden" id="addDeleteUserForm">
        <h1>Delete User</h1>
        <form class="add-formStyle">
            <label for="Email">Enter Email
            </label>
            <br>
            <input type="text" id="inputDeleteUser" size="50">
            <br>
            <button id="deleteUserSubmitButton">Submit</button>
        </form>
    </div>
    <div id="buttons-admin" class="hidden">
        <button onclick="showUser(event)">Show User</button>
        <button onclick='addUserGroup(event)'>Add User</button>
        <button onclick='addAdminGroup(event)'>Add Admin</button>
        <button onclick="deleteUSer(event)">Delete User</button>
    </div>
    <div id="buttons-user" class="hidden">
        <button onclick="showUser(event)">Show User</button>
    </div>
    <div id="user-list" class="hidden">
        <!-- <div class="user-row">User1</div>
        <div class="user-row">User1</div> -->

    </div>
    
    
</div>
    </div>
<div class="right">
    <div id="chatHeader">
        <!-- <h1>Group Chat</h1>
        <button>Add Admin</button>
        <button>Remove Admin</button>
        <button>Show User</button>
        <button>Add User</button>   -->
    </div>
    <div id="chatMessage">
          
    </div>

<!-- 

<script>
    
  window.addEventListener('load',users =>{
    const token=localStorage.getItem('token')
    axios.get('http://localhost:4000/users',{headers:{"Authorization":token}})
      .then(response => {
        // console.log(response);
        if(response.status == 200){
            response.data.users.forEach(user => {
                showUsers(user)
                
            });
        }else {
            throw new Error();
        }
      })
      .catch(err => {
        console.log(err)
      })
    
      
    })
    function showUsers(user){
    const parentNode = document.getElementById('chats');
    parentNode.innerHTML += `
      <li>
        ${user.name} join...
      </li>
      `
    }
    //send message
    document.getElementById('btn').addEventListener('click',(e)=>{
        e.preventDefault();
    let token=localStorage.getItem('token')
    let chatMessage = document.getElementById("chatMessageInput").value;
    let reqObj={
        chatMessage
    }
    axios.post("http://localhost:4000/message",reqObj,{headers:{ 'Authorization':token} }).then(result=>{
        let userName=result.data.user.name;
        // alert(result.data.message)
        showMessage(userName,chatMessage)
        console.log(result)
    }).catch(err=>{
        console.log(err)
    });
})
    const parentNode1 = document.getElementById('msg');
    function showMessage(name,msg){
      parentNode1.innerHTML += `<li>${name}:${msg}</li>`
      
    }

     //get all messages without group
       
        setIhnterval(()=>{
            const token = localStorage.getItem('token');
    let messagesObj = JSON.parse(localStorage.getItem("messagesObj"));
    let lastMessageId;
    if(messagesObj){ 
      let lastObj=messagesObj[(messagesObj.length-1)]
      lastMessageId=lastObj.id;
    }else{
      lastMessageId=0;
    }
    axios
      .get(
        `http://localhost:4000/getAllMessage?lastMessageId=${lastMessageId}`,{headers:{'Authorization':token}}
      )
      .then((response) => {
        let message = response.data.result;       
        if(!localStorage.getItem('messagesObj')){
          localStorage.setItem("messagesObj",JSON.stringify(message));
        }else{
          if(message.length>0){
           messagesObj.push(message[0]);     
           localStorage.setItem("messagesObj", JSON.stringify(messagesObj));
          }
        }
        parentNode1.innerHTML  = " ";
        if(Array.isArray(messagesObj)){
         messagesObj.forEach((element) => {
           if (element.messageText == "JOINED") {
             showUsers(element.name);
           } else showMessage( element.name,element.messageText);
         });
       }


      })
      .catch((err) => {
        console.log(err);
      });
},2000);


    

</script> -->
<!-- <script src="./js/groupWindow.js"></script> -->
<script src = './chat.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>

</body>
</html>