<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- axios cdn -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
    <link rel="stylesheet" href="./chat.css">
    <title>Chat Window</title>
</head>
<body>
    <h2 id="app">Chat Window</h2>

    <div id="chats" style="align-items: center; width: 65%; height: 45%; background-color: rgb(166, 201, 231); list-style: none;">
    </div>
    <div id="msg" style="list-style:none;">

    </div>

<footer style="margin-top: 15%; ">
    <form >
        <label for="msg"></label>
        <input id='chatMessageInput' type="text" name="msg">
        <button id="btn"  type="submit" >Send</button>
    </form>
</footer>


<button type="submit" id="createGroup">Create a group</button>
<form id="chatGroup" style="display: none;" onsubmit="createGroup(event)">
  <label for="group"></label>
  <input type="text" name="group" placeholder="group name">
  <button type="submit" >Create Group</button>
</form>
<section id="groupWindow" class="container">
  <h2>Group Window</h2>
  <div class='group-details'>
      <ul id="group-list" style="list-style: none;">
        <!-- added the list of all groups when clock on button-->
      </ul>
  </div>
</section>
<button type="submit" id="getgroup">Show All Groups</button>
<hr>


<script>
    
  window.addEventListener('load',users =>{
    const token=localStorage.getItem('token')
    axios.get('http://localhost:4000/users',{headers:{"Authorization":token}})
      .then(response => {
        // console.log(response);
        if(response.status == 200){
            response.data.users.forEach(user => {
                showUsers(user)
                
            });
        }else {
            throw new Error();
        }
      })
      .catch(err => {
        console.log(err)
      })
    
      
    })
    function showUsers(user){
    const parentNode = document.getElementById('chats');
    parentNode.innerHTML += `
      <li>
        ${user.name} join...
      </li>
      `
    }
    //send message
    document.getElementById('btn').addEventListener('click',(e)=>{
        e.preventDefault();
    let token=localStorage.getItem('token')
    let chatMessage = document.getElementById("chatMessageInput").value;
    let reqObj={
        chatMessage
    }
    axios.post("http://localhost:4000/message",reqObj,{headers:{ 'Authorization':token} }).then(result=>{
        let userName=result.data.user.name;
        alert(result.data.message)
        showMessage(userName,chatMessage)
        console.log(result)
    }).catch(err=>{
        console.log(err)
    });
})
    const parentNode1 = document.getElementById('msg');
    function showMessage(name,msg){
      parentNode1.innerHTML += `<li>${name}:${msg}</li>`
      
    }
    function showMessageinUI(message,userName){
    chatMessage.innerHTML+=`<p>${userName}: ${message}`
}
     //get all messages without group
     window.addEventListener("DOMContentLoaded",()=>{
        const token = localStorage.getItem('token');
    axios.get("http://localhost:4000/getAllmessage",{headers:{'Authorization':token}}).then(response=>{
        let message=response.data.result;

        message.forEach(element => {
            showMessage(element.name,element.messageText)
        });
    }).catch(err=>{
        console.log(err)
    });
});

    

</script>
<!-- <script src="./js/groupWindow.js"></script> -->
</body>
</html>